<!doctype html5>
<head>
<script src="https://vk.com/js/api/xd_connection.js?2" type="text/javascript"></script>
<script type="text/javascript"> 
  VK.init(function() { }); 
</script>
<script>
var imgcount=0;
var albumscount=0;
function clear(text) {
   document.getElementById('status').innerHTML = '';
}
  
function append(text) {
   document.getElementById('status').innerHTML += text;
}
  
function autosize(width) {
        //Проверяем элемент body на наличие.
        if (!document.getElementById('body')) {
			alert('error');
            return;
        }
        // Успешно ли подключен ВК скрипт
        if (typeof VK.callMethod != 'undefined') {
        /*
        Вызываем функцию vk js api для управления окном.
        VK.callMethod('функция', параметры)
        В данном случае у нас - VK.callMethod('изменение_размеров_окна', ширина, высота);
        Так же добавляем еще 60 пикселей что бы было небольшое расстояние.
        */
            VK.callMethod('resizeWindow', 840, document.getElementById('body').clientHeight + 60);
        } else {
	    alert('error #2');
        }
    }
 
function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
} 

function VKAPI_photosget(oid,aid,itr)
{
	VK.api(
			'photos.get',
			{owner_id: oid, album_id: aid},
			function(data) { 
			console.log(data);
			if (data.response) { 
				for (var j in data.response) {
				//append(data.response[j].pid + ' ');
				imgcount++;
				}
			append(Number(100*itr/albumscount).toFixed(2) + '% P[' + j + '] ');
			if(itr==albumscount){append('TOTAL[' + imgcount + '] ');}
			} else {
				clear();
				append('Error: <pre>' + JSON.stringify(data.error, null, '  ') + '</pre>');
			}
			});
}

  
function loadAlbums(owner_id) {
  var albums=[];
  imgcount=0;
  clear();
  VK.api(
    'photos.getAlbums',
    {owner_id: owner_id},
    function(data) { 
      console.log(data);
      if (data.response) { 
	// albumscount=data.length;
         for (var i in data.response) {
           	   //append(data.response[i].aid + ' ');
		   albums[i]=data.response[i].aid;
		   //sleep(3000);
		   setTimeout(VKAPI_photosget,350*i,owner_id,albums[i],i);
         }
	 append('A[' + i + ']');
	  albumscount=i;
	 //append('TOTAL:' + imgcount);
      } else {
         clear();
         append('Error: <pre>' + JSON.stringify(data.error, null, '  ') + '</pre>');
      }
  });
/*  for (var i in albums) {
	VK.api(
		'photos.get',
		{owner_id: owner_id, album_id: albums[i]},
		function(data) { 
		console.log(data);
		if (data.response) { 
			for (var j in data.response) {
			append(data.response[j].id + ' ');
			imgcount++;
			}
		append('TOTAL:' + j);
		} else {
			clear();
			append('Error: <pre>' + JSON.stringify(data.error, null, '  ') + '</pre>');
		}
	});
  }*/
  
  VK.callMethod("resizeWindow", 800, 4000); 
}

</script>
</head>
<body>

ID сообщества:
<input type="text" id="owner_id">
<button onclick="loadAlbums(document.getElementById('owner_id').value)">Load Albums</button>

<div id="status"></div>

</body>
